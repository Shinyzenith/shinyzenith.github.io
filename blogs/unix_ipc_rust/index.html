<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>UNIX domain socket IPC in Rust. | Shinyzenith</title><meta name=keywords content="Rust,Waycrate"><meta name=description content="The IPC patch is complete and has been merged into the main branch.
The patch was made possible with the interprocess crate and was later rewritten to raw stdlib implementation in this commit. Currently the server binary (swhks) makes a socket at /run/user/(YourUserID)/swhkd.sock which then the daemon binary (swhkd) tries to establish a connection with.
After merging the initial set of patches Ckyiu found 2 issues right away:
Calling the function physical_path() on any evdev::Device object returns None on virtual machines and hence the binary panics and crashes while attempting to execute ."><meta name=author content="Aakash Sen Sharma"><link rel=canonical href=https://aakash.is-a.dev/blogs/unix_ipc_rust/><link crossorigin=anonymous href=/assets/css/stylesheet.ff3aa7e6455554ffb185f91c2e4a41817100fcc30793f0a1beda419f0685e820.css integrity="sha256-/zqn5kVVVP+xhfkcLkpBgXEA/MMHk/ChvtpBnwaF6CA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href="https://avatars.githubusercontent.com/u/60808802?v=4"><link rel=icon type=image/png sizes=16x16 href="https://avatars.githubusercontent.com/u/60808802?v=4"><link rel=icon type=image/png sizes=32x32 href="https://avatars.githubusercontent.com/u/60808802?v=4"><link rel=apple-touch-icon href="https://avatars.githubusercontent.com/u/60808802?v=4"><link rel=mask-icon href="https://avatars.githubusercontent.com/u/60808802?v=4"><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="UNIX domain socket IPC in Rust."><meta property="og:description" content="The IPC patch is complete and has been merged into the main branch.
The patch was made possible with the interprocess crate and was later rewritten to raw stdlib implementation in this commit. Currently the server binary (swhks) makes a socket at /run/user/(YourUserID)/swhkd.sock which then the daemon binary (swhkd) tries to establish a connection with.
After merging the initial set of patches Ckyiu found 2 issues right away:
Calling the function physical_path() on any evdev::Device object returns None on virtual machines and hence the binary panics and crashes while attempting to execute ."><meta property="og:type" content="article"><meta property="og:url" content="https://aakash.is-a.dev/blogs/unix_ipc_rust/"><meta property="og:image" content="https://avatars.githubusercontent.com/u/60808802?v=4"><meta property="article:section" content="blogs"><meta property="article:published_time" content="2022-02-08T00:00:00+00:00"><meta property="article:modified_time" content="2022-02-08T00:00:00+00:00"><meta property="og:site_name" content="Aakash Sharma"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://avatars.githubusercontent.com/u/60808802?v=4"><meta name=twitter:title content="UNIX domain socket IPC in Rust."><meta name=twitter:description content="The IPC patch is complete and has been merged into the main branch.
The patch was made possible with the interprocess crate and was later rewritten to raw stdlib implementation in this commit. Currently the server binary (swhks) makes a socket at /run/user/(YourUserID)/swhkd.sock which then the daemon binary (swhkd) tries to establish a connection with.
After merging the initial set of patches Ckyiu found 2 issues right away:
Calling the function physical_path() on any evdev::Device object returns None on virtual machines and hence the binary panics and crashes while attempting to execute ."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blogs","item":"https://aakash.is-a.dev/blogs/"},{"@type":"ListItem","position":2,"name":"UNIX domain socket IPC in Rust.","item":"https://aakash.is-a.dev/blogs/unix_ipc_rust/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"UNIX domain socket IPC in Rust.","name":"UNIX domain socket IPC in Rust.","description":"The IPC patch is complete and has been merged into the main branch.\nThe patch was made possible with the interprocess crate and was later rewritten to raw stdlib implementation in this commit. Currently the server binary (swhks) makes a socket at /run/user/(YourUserID)/swhkd.sock which then the daemon binary (swhkd) tries to establish a connection with.\nAfter merging the initial set of patches Ckyiu found 2 issues right away:\nCalling the function physical_path() on any evdev::Device object returns None on virtual machines and hence the binary panics and crashes while attempting to execute .","keywords":["Rust","Waycrate"],"articleBody":" The IPC patch is complete and has been merged into the main branch.\nThe patch was made possible with the interprocess crate and was later rewritten to raw stdlib implementation in this commit. Currently the server binary (swhks) makes a socket at /run/user/(YourUserID)/swhkd.sock which then the daemon binary (swhkd) tries to establish a connection with.\nAfter merging the initial set of patches Ckyiu found 2 issues right away:\nCalling the function physical_path() on any evdev::Device object returns None on virtual machines and hence the binary panics and crashes while attempting to execute .unwrap() on it. This issue has been taken care of in this commit.\nThe old error message ‚ÄúInvoking user is NOT in input group.‚Äù would lead users to add themselves to the input group, and we definitely don‚Äôt want that as stated in the previous blog. To counter this issue, swhkd now warns the user if they have input group access and gracefully exits.\nAll that remains now is config file handling which has been assigned to Angelo Fallaria, and key event handling which I will be implementing.\nThat is all for now üòÄ.\n","wordCount":"186","inLanguage":"en","datePublished":"2022-02-08T00:00:00Z","dateModified":"2022-02-08T00:00:00Z","author":[{"@type":"Person","name":"Aakash Sen Sharma"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://aakash.is-a.dev/blogs/unix_ipc_rust/"},"publisher":{"@type":"Organization","name":"Shinyzenith","logo":{"@type":"ImageObject","url":"https://avatars.githubusercontent.com/u/60808802?v=4"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove('dark')</script><header class=header><nav class=nav><div class=logo><a href=https://aakash.is-a.dev/ accesskey=h title="  (Alt + H)"></a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://github.com/Shinyzenith title=GitHub><span>GitHub</span></a></li><li><a href=mailto:aakash@shinyzenith.xyz title=Email><span>Email</span></a></li><li><a href=https://aakash.is-a.dev/pgp title=PGP><span>PGP</span></a></li><li><a href=https://aakash.is-a.dev/tags title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://aakash.is-a.dev/>Home</a>&nbsp;¬ª&nbsp;<a href=https://aakash.is-a.dev/blogs/>Blogs</a></div><h1 class=post-title>UNIX domain socket IPC in Rust.</h1><div class=post-meta><span title='2022-02-08 00:00:00 +0000 UTC'>February 8, 2022</span>&nbsp;¬∑&nbsp;1 min&nbsp;¬∑&nbsp;186 words&nbsp;¬∑&nbsp;Aakash Sen Sharma</div></header><div class=post-content><hr><p>The <a href=https://github.com/waycrate/swhkd/pull/10>IPC patch</a> is complete and has been merged into the main branch.</p><p>The patch was made possible with the <a href=https://crates.io/crates/interprocess>interprocess crate</a> and was later rewritten to raw stdlib implementation
in <a href=https://github.com/waycrate/swhkd/commit/35d4960d87b8e2ac6e8a32fd642b1f7555f3ec2a>this commit</a>. Currently the server binary (<code>swhks</code>) makes a
socket at <code>/run/user/(YourUserID)/swhkd.sock</code> which then the daemon binary (<code>swhkd</code>) tries to establish a connection with.</p><p>After merging the initial set of patches <a href=https://github.com/unsignedarduino>Ckyiu</a> found 2 issues right away:</p><ul><li><p>Calling the function <code>physical_path()</code> on any <code>evdev::Device</code> object returns None on virtual machines and hence the binary panics and crashes while
attempting to execute <code>.unwrap()</code> on it. This issue has been taken care of in this <a href=https://github.com/waycrate/swhkd/commit/1e01014a1436a3983f09c57574b0bca4ff5adfcb>commit.</a></p></li><li><p>The old error message &ldquo;Invoking user is NOT in input group.&rdquo; would lead users to add themselves to the input group, and we definitely don&rsquo;t want that
as stated in the <a href=https://shinyzenith.xyz/blogs/swhkd_rust_rewrite/>previous blog</a>. To counter this issue, <a href=https://github.com/waycrate/swhkd/commit/faecfcf61784a1dfe3c43fa8b4ca303c5b3137b5>swhkd now warns the user</a> if they have input group access and gracefully exits.</p></li></ul><p>All that remains now is config file handling which has been assigned to <a href=https://angelo.is-a.dev/>Angelo Fallaria</a>, and key event handling which I will
be implementing.</p><p>That is all for now üòÄ.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://aakash.is-a.dev/tags/rust/>Rust</a></li><li><a href=https://aakash.is-a.dev/tags/waycrate/>Waycrate</a></li></ul><nav class=paginav><a class=prev href=https://aakash.is-a.dev/blogs/tinywl_nim/><span class=title>¬´ Prev</span><br><span>Wayland Compositor written in nim.</span></a>
<a class=next href=https://aakash.is-a.dev/blogs/swhkd_rust_rewrite/><span class=title>Next ¬ª</span><br><span>Rewriting swhkd in rust!</span></a></nav></footer></article></main><footer class=footer><span>Copyright &copy; 2022 <a href=https://aakash.is-a.dev/>Shinyzenith</a> | <a href=https://github.com/Shinyzenith/website target=_blank>0BSD Source Code</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script><script>document.querySelectorAll('pre > code').forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement('button');e.classList.add('copy-code'),e.innerHTML='copy';function s(){e.innerHTML='copied!',setTimeout(()=>{e.innerHTML='copy'},2e3)}e.addEventListener('click',o=>{if('clipboard'in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand('copy'),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>